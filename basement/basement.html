<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–æ–¥–≤–∞–ª—ã</title>
  <link rel="stylesheet" href="../style.css">
</head>

<body>
<div class="container">

  <header class="app-header">
    <a href="../index.html" class="header-back">‚Üê</a>
    <div class="header-title">–ü–æ–¥–≤–∞–ª—ã</div>
  </header>

  <div class="category-nav">
    <a class="category-link active" href="basement.html">–ü–æ–¥–≤–∞–ª—ã</a>
    <a class="category-link" href="../first-floor/first-floor.html">1 —ç—Ç–∞–∂</a>
    <a class="category-link" href="../shops/shops.html">–ú–∞–≥–∞–∑–∏–Ω—ã</a>
  </div>

  <div class="price-filter-bar">
    <button class="price-filter-btn active" data-range="all">–í—Å–µ</button>
    <button class="price-filter-btn" data-min="5000000" data-max="10000000">5‚Äì10 –º–ª–Ω</button>
    <button class="price-filter-btn" data-min="10000000" data-max="15000000">10‚Äì15 –º–ª–Ω</button>
    <button class="price-filter-btn" data-min="15000000" data-max="20000000">15‚Äì20 –º–ª–Ω</button>
    <button class="price-filter-btn" data-min="20000000" data-max="30000000">20‚Äì30 –º–ª–Ω</button>
    <button class="price-filter-btn" data-min="30000000">30+ –º–ª–Ω</button>
  </div>

  <div class="properties-grid" id="propertiesContainer"></div>

  <footer class="site-footer">
    <div class="footer-social">
      <a href="https://t.me/snowbobr" target="_blank">
        <svg viewBox="0 0 24 24">
          <path d="M9.04 15.44l-.38 5.36c.55 0 .79-.24 1.08-.52l2.6-2.47 5.39 3.94c.99.55 1.7.26 1.95-.91l3.54-16.6c.31-1.45-.52-2.02-1.49-1.66L1.15 9.77c-1.4.55-1.38 1.34-.24 1.69l5.36 1.67L18.6 6.42"/>
        </svg>
      </a>
    </div>
    <a href="tel:+79265524725" class="footer-phone">
      +7 (926) 552-47-25
    </a>
  </footer>

</div>

<script>
const API_URL = "http://147.45.212.213:3001/objects";
const container = document.getElementById("propertiesContainer");
const filterButtons = document.querySelectorAll(".price-filter-btn");

let allObjects = [];

async function loadObjects() {
  const res = await fetch(API_URL);
  const data = await res.json();

  // —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  allObjects = data.filter(obj => obj.category === "–ü–æ–¥–≤–∞–ª");

  renderObjects(allObjects);
}

function renderObjects(objects) {
  container.innerHTML = "";

  objects.forEach(obj => {
    const card = document.createElement("a");
    card.href = `property.html?id=${obj.id}`;
    card.className = "property-card";
    card.dataset.price = obj.price;

    card.innerHTML = `
      <img src="../images/Frame2.png" class="property-image">
      <div class="property-info">
        <h3>${obj.title}</h3>
        <div class="address">üìç ${obj.address}</div>
        <div class="description">${obj.description}</div>
        <div class="property-price">
          ${Number(obj.price).toLocaleString()} ‚ÇΩ
        </div>
      </div>
    `;

    container.appendChild(card);
  });
}

filterButtons.forEach(btn => {
  btn.addEventListener("click", () => {

    filterButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    const min = btn.dataset.min ? Number(btn.dataset.min) : 0;
    const max = btn.dataset.max ? Number(btn.dataset.max) : Infinity;

    const filtered = btn.dataset.range === "all"
      ? allObjects
      : allObjects.filter(obj => obj.price >= min && obj.price <= max);

    renderObjects(filtered);
  });
});

loadObjects();
</script>

</body>
</html>
